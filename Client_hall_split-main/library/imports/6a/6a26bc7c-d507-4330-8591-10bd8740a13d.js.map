{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\SysData/assets\\script\\dbmanager\\SysData\\SysDataManager.js"],"names":["app","require","SysDataManager","BaseClass","extend","Init","JS_Name","FieldLine","DataLine","Key","isNative","tableDict","jsonDict","Log","room_cost","game_create","GetTableDict","tableName","ErrLog","allSelectCityData","HeroManager","GetCurSelectCityData","json","curselectId","clubData","cityId","clubDataTemp","ClubManager","GetClubDataByClubID","clubId","unionData","Number","toString","costs","key","parseInt","substring","games","allServer","Client","allGameIdFormServer","length","names","concat","indexOf","push","Name","GameName","GetJsonData","dataDict","ReloadTable","keyNameList","hasOwnProperty","that","ReadTable","then","textData","keyList","Object","keys","count","index","keyName","OnLoadTableEnd","catch","error","stack","DeleteTable","tablePath","promisefunc","resolve","reject","cc","loader","loadRes","bluebird","tableInfo","TransformTextData","DecodeText","textDataList","text","split","lineCount","lineNum","fieldNameList","fieldCount","tableDataDict","index_i","textLineDataStr","replace","textLineDataList","rowCount","JSON","stringify","rowKey","rowDataDict","index_j","value","GetTransformValue","undefined","buffCount","outText","String","fromCharCode","valueStr","startStr","endStr","parse","Function","isNaN","GetKeyNameStr","valueDict","keyValueList","join","OnLoadJson","jsonFileName","jsonData","GetMuchKeyStr","DebugOutput","g_SysDataManager","exports","GetModel"],"mappings":"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","file":"SysDataManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\SysData","sourcesContent":["/*\n    客户端系统配置表管理器\n*/\nvar app = require('app');\n\nvar SysDataManager = app.BaseClass.extend({\n\n    Init:function(){\n    \tthis.JS_Name = \"SysDataManager\";\n\n\t\t//字段key开始行\n\t\tthis.FieldLine = 1;\n\t\t//有效配置开始行\n\t\tthis.DataLine = 2;\n\n\t\tthis.Key = 1245;\n\n\t\tthis.isNative = false;\n\n    \tthis.tableDict = {};\n\n    \tthis.jsonDict = {};\n\n    \tthis.Log(\"Init\");\n\n\t\tthis.room_cost = {}\n\t\tthis.game_create = {}\n    },\n\n\t// 获取表字典数据\n\tGetTableDict:function(tableName){\n\t\t//如果表为读取，则读取\n\t\tif (!this.tableDict[tableName]){\n\t\t\tthis.ErrLog(\"GetTableDict (%s) not load!\",tableName);\n\t\t\treturn {}\n\t\t}\n\t\tif (tableName == \"roomcost\" || tableName == \"gameCreate\") {\n\t\t\tlet allSelectCityData = app.HeroManager().GetCurSelectCityData();\n\t\t\tif(!allSelectCityData){\n\t\t\t\treturn this.tableDict[tableName].json;\n\t\t\t}\n\t\t\tlet curselectId = allSelectCityData[0] ? allSelectCityData[0]['selcetId'] : 0;\n\t\t\tif (this.clubData != null) {\n\t\t\t\tcurselectId = this.clubData.cityId;\n\t\t\t\tif (typeof (curselectId) == \"undefined\") {\n\t\t\t\t\tlet clubDataTemp = app.ClubManager().GetClubDataByClubID(this.clubData.clubId);\n\t\t\t\t\tcurselectId = clubDataTemp.cityId;\n\t\t\t\t}\n\t\t\t} else if (this.unionData != null) {\n\t\t\t\tcurselectId = this.unionData.cityId;\n\t\t\t}\n\t\t\tif (!Number(curselectId)) {\n\t\t\t\treturn this.tableDict[tableName].json;\n\t\t\t}\n\t\t\tcurselectId = curselectId.toString()\n\t\t\tif (tableName == \"roomcost\") \n\t\t\t{\n\t\t\t\tif(!this.room_cost[curselectId]){\n\t\t\t\t\tlet costs = {}\n\t\t\t\t\tfor (let key in this.tableDict[\"roomcost\"].json) {\n\t\t\t\t\t\tif (parseInt(key.substring(0, 7)) != curselectId) continue;\n\t\t\t\t\t\tcosts[key] = this.tableDict[\"roomcost\"].json[key]\n\t\t\t\t\t}\n\t\t\t\t\tthis.room_cost[curselectId] = costs\n\t\t\t\t\treturn this.room_cost[curselectId]\n\t\t\t\t}\n\t\t\t\telse if(this.room_cost[curselectId]){\n\t\t\t\t\treturn this.room_cost[curselectId]\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (tableName == \"gameCreate\"){\n\t\t\t\tif(!this.game_create[curselectId]) \n\t\t\t\t{\n\t\t\t\t\tlet games = {}\n\t\t\t\t\tlet allServer = app.Client.allGameIdFormServer\n\t\t\t\t\tif (!allServer || allServer.length == 0) {\n\t\t\t\t\t\treturn this.tableDict[tableName].json;\n\t\t\t\t\t}\n\t\t\t\t\tlet names = []\n\t\t\t\t\tfor (const key in this.tableDict[\"gametype\"].json) {\n\t\t\t\t\t\tif (key == \"4\") {\n\t\t\t\t\t\t\tnames = names.concat([\"zyqz_nn\",\"nnsz_nn\",\"gdzj_nn\",\"mpqz_nn\",\"tbnn_nn\",\"lz_nn\",\"nn\"])\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key == \"18\") {\n\t\t\t\t\t\t\tnames = names.concat([\"zyqz_sg\",\"sgsz_sg\",\"gdzj_sg\",\"tb_sg\",\"mpqz_sg\",\"sg\"])\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key == \"1\") {\n\t\t\t\t\t\t\tnames = names.concat([\"sss_dr\",\"sss_zz\"])\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (allServer.indexOf(key) >= 0) {\n\t\t\t\t\t\t\tnames.push(this.tableDict[\"gametype\"].json[key].Name)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tfor (let key in this.tableDict[\"gameCreate\"].json) {\n\t\t\t\t\t\tif (names.indexOf(this.tableDict[\"gameCreate\"].json[key].GameName) == -1) continue;\n\t\t\t\t\t\tgames[key] = this.tableDict[\"gameCreate\"].json[key]\n\t\t\t\t\t}\n\t\t\t\t\tthis.game_create[curselectId] = games\n\t\t\t\t\treturn this.game_create[curselectId]\n\t\t\t\t}\n\t\t\t\telse if(this.game_create[curselectId]){\n\t\t\t\t\treturn this.game_create[curselectId]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.tableDict[tableName].json;\n\t},\n\n\t//获取json配置文件\n\tGetJsonData:function(tableName){\n\t\tlet dataDict = this.jsonDict[tableName];\n\t\tif(!dataDict){\n\t\t\tthis.ErrLog(\"GetJsonData tableName:%s not find\", tableName);\n\t\t\treturn\n\t\t}\n\t\treturn dataDict\n\t},\n\n\t// 重载表数据\n\tReloadTable:function(tableName, keyNameList=\"\"){\n\n\t\t//可能本身就不存在表数据,初始化空字典\n\t\tif(!this.tableDict.hasOwnProperty(tableName)){\n\t\t\tthis.tableDict[tableName] = {};\n\t\t}\n\n\t\tlet that = this;\n\n\t\tthis.ReadTable(tableName)\n\t\t\t.then(function(textData){\n\t\t\t\t\n\t\t\t\tlet dataDict = that.tableDict[tableName];\n\n\t\t\t\t//清空原来的字典数据\n\t\t\t\tlet keyList = Object.keys(dataDict);\n\t\t\t\tlet count = keyList.length;\n\t\t\t\tfor(let index=0; index<count; index++){\n\t\t\t\t\tlet keyName = keyList[index];\n\t\t\t\t\tdelete dataDict[keyName];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthat.OnLoadTableEnd(tableName, keyNameList, textData, dataDict);\n\t\t\t})\n\t\t\t.catch(function(error){\n\t\t\t\tthat.ErrLog(\"ReloadTable(%s) error:%s\", tableName, error.stack);\n\t\t\t})\n\t},\n\n\t// 删除表数据\n\tDeleteTable:function(tableName){\n\t\tdelete this.tableDict[tableName];\n\t},\n\n\t// 读取表数据\n\tReadTable:function(tableName){\n\t\t\n\t\tvar that = this;\n    \tvar tablePath = 'configs/' + tableName;\n\n        //创建异步函数\n        let promisefunc = function(resolve, reject){\n                                                    //加载资源\n                                                    cc.loader.loadRes(tablePath, function (error, textData) {\n\n                                                        if(error){\n                                                            reject(error);\n                                                            return\n                                                        }\n\n                                                        resolve(textData);\n\n                                                    })};\n        //返回异步对象\n        return new app.bluebird(promisefunc);\n\n    },\n\n    // 表数据读取完成\n\tOnLoadTableEnd:function(tableName, keyNameList, textData, tableInfo={}){\n\t\tthis.tableDict[tableName] = textData;\n\t},\n\t\n\t// 转化表为字典\n\tTransformTextData:function(tableName, textData){\n\n\t\tif(this.isNative){\n\t\t\ttextData = this.DecodeText(textData);\n\t\t}\n\n\t\tlet textDataList = textData.text.split(\"\\n\");\n\t\tlet lineCount = textDataList.length;\n\t\tif(!lineCount){\n\t\t\tthis.ErrLog(\"TransformTextData(%s) not data\", tableName);\n\t\t\treturn\n\t\t}\n\t\tlet lineNum = -1;\n\n\t\tlet fieldNameList = null;\n\t\tlet fieldCount = null;\n\n\t\tlet tableDataDict = {};\n\n\t\tfor(let index_i =0; index_i<lineCount; index_i++){\n\t\t\tlet textLineDataStr = textDataList[index_i];\n\n\t\t\t//去除空格\n\t\t\ttextLineDataStr = textLineDataStr.replace(/(\\s*$)/g, \"\");\n\t\t\t//读到最后一行，跳出\n\t\t\tif(!textLineDataStr){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlineNum += 1;\n\t\t\tlet textLineDataList = textLineDataStr.split(\"\\t\");\n\t\t\t\n\t\t\t//如果是key行,记录key数据\n\t\t\tif(lineNum === this.FieldLine){\n\t\t\t\tfieldNameList = textLineDataList;\n\t\t\t\tfieldCount = fieldNameList.length;\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\telse if(lineNum >= this.DataLine){\n\t\t\t\t\n\t\t\t\tlet rowCount = textLineDataList.length;\n\t\t\t\tif(rowCount != fieldCount){\n\t\t\t\t\tthis.ErrLog(\"TransformTextData(%s),textLineDataList:%s error need(%s)\", tableName, JSON.stringify(textLineDataList), fieldCount);\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tlet rowKey = textLineDataList[0];\n\t\t\t\tlet rowDataDict = {};\n\t\t\t\tfor(var index_j=0; index_j<rowCount; index_j++){\n\t\t\t\t\tlet value = textLineDataList[index_j];\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvalue = this.GetTransformValue(value);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(error){\n\t\t\t\t\t\tthis.ErrLog(\"GetTransformValue(%s)(%s), error:%s\", tableName, value, error.stack);\n\t\t\t\t\t\t//throw new Error(\"Read Text Fail:\" + tablePath);\n\t\t\t\t\t\tvalue = undefined;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\trowDataDict[fieldNameList[index_j]] = value;\n\t\t\t\t}\n\t\t\t\tif(tableName == \"gameCreate\" || tableName == \"GameHelp\"){\n\t\t\t\t\ttableDataDict[index_i] = rowDataDict;\n\t\t\t\t}else{\n\t\t\t\t\ttableDataDict[rowKey] = rowDataDict;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\t\n\t\t\t}\n\t\t}\n\n\t\treturn tableDataDict\n\t},\n\n\t//解密\n\tDecodeText:function(textData){\n\n\t\tlet buffCount = textData.length;\n\t\tlet outText = \"\";\n\n\t\t//遍历字符串解密\n\t\tfor(let index_j=0; index_j<buffCount; ){\n\n\t\t\tlet value = textData.substring(index_j, index_j+4);\n\t\t\tvalue = parseInt(value,16)^this.Key;\n\t\t\toutText += String.fromCharCode(value);\n\n\t\t\tindex_j += 4;\n\t\t}\n\n\n\t\treturn outText\n\t},\n\t\n\t/**\n\t * 获取value转化后的值\n\t */\n\tGetTransformValue:function(valueStr){\n\t\tlet startStr = valueStr[0];\n\t\tlet endStr = valueStr[valueStr.length-1];\n\t\t//如果是列表\n\t\tif(startStr === \"[\" && endStr === \"]\"){\n\t\t\treturn JSON.parse(valueStr);\n\t\t}\n\t\telse if(startStr === \"{\" && endStr === \"}\"){\n\t\t\treturn JSON.parse(valueStr);\n\t\t}\n\t\telse if (valueStr.indexOf(\"return\") != -1){\n\t\t\treturn new Function(valueStr);\n\t\t}\n\t\telse{\n\t\t\t//去整\n\t\t\t//如果不是纯数字,则为字符串\n\t\t\tif(isNaN(valueStr)){\n\t\t\t\treturn valueStr\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn Number(valueStr)\n\t\t\t}\n\t\t}\n\n\t},\n\n\t// 获取表字段名对应联合表key字符串\n\tGetKeyNameStr:function(keyNameList, valueDict){\n\n\t\tlet keyValueList = [];\n\t\tlet count = keyNameList.length;\n\n\t\t//构建联合表key 字符串\n\t\tfor(let index = 0; index < count; index++){\n\t\t\tlet keyName = keyNameList[index];\n\t\t\tif (!valueDict.hasOwnProperty(keyName)){\n\t\t\t\tthis.ErrLog(\"GetKeyNameStr valueDict(%s) dont have keyName(%s)\", JSON.stringify(valueDict), keyName);\n\t\t\t\treturn null\n\t\t\t}\n\t\t\tkeyValueList.push(valueDict[keyName]);\n\t\t}\n\n\t\treturn keyValueList.join(\"_\")\n\t},\n\t\n\t//加载json配置文件\n\tOnLoadJson:function(jsonFileName, jsonData){\n\n\t\tthis.jsonDict[jsonFileName] = jsonData;\n\t},\n\t//--------------------------联合key接口--------------------------------\n\t\n\t// 获取联合表keylist 对应的keystr\n\tGetMuchKeyStr:function(keyList){\n\t\treturn keyList.join(\"_\")\n\t},\n\t\n\t// 表数据输出\n\tDebugOutput:function(tableName=\"\"){\n\n\t\tlet tableInfo = null;\n\t\t\n\t\t//如果是指定表\n\t\tif(tableName){\n\t\t\ttableInfo = this.tableDict[tableName];\n\t\t}\n\t\telse{\n\t\t\ttableInfo = this.tableDict;\n\t\t}\n\n\t\tthis.Log(\"DebugOutput:%s\", JSON.stringify(tableInfo));\n\t\t\n\t}\n\n});\n\n\nvar g_SysDataManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n    if(!g_SysDataManager){\n        g_SysDataManager = new SysDataManager();\n    }\n    return g_SysDataManager;\n}"]}